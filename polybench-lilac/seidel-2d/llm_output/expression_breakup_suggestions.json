{
  "function_name": "kernel_stencil",
  "breakups": [
    {
      "line_number": 166,
      "original_expression": "((((((((A[(((i - STENCIL_HALO_RADIUS) * n + j) - STENCIL_HALO_RADIUS)] + A[((i - STENCIL_HALO_RADIUS) * n + j)]) + A[(((i - 1) * n + j) + 1)]) + A[((i * n + j) - 1)]) + A[(i * n + j)]) + A[((i * n + j) + 1)]) + A[(((i + 1) * n + j) - 1)]) + A[((i + 1) * n + j)]) + A[(((i + 1) * n + j) + 1)]) / STENCIL_NEIGHBOR_COUNT",
      "breakup_steps": [
        {
          "temp_var": "center_idx",
          "expression": "i * n + j",
          "description": "Linear index of the center element"
        },
        {
          "temp_var": "r",
          "expression": "STENCIL_HALO_RADIUS",
          "description": "Alias the stencil halo radius for readability"
        },
        {
          "temp_var": "i_mr",
          "expression": "i - r",
          "description": "Row index r steps above center"
        },
        {
          "temp_var": "j_mr",
          "expression": "j - r",
          "description": "Column index r steps left of center"
        },
        {
          "temp_var": "i_m1",
          "expression": "i - 1",
          "description": "Row index one above center (matches original expression)"
        },
        {
          "temp_var": "j_p1",
          "expression": "j + 1",
          "description": "Column index one right of center"
        },
        {
          "temp_var": "i_p1",
          "expression": "i + 1",
          "description": "Row index one below center"
        },
        {
          "temp_var": "j_m1",
          "expression": "j - 1",
          "description": "Column index one left of center"
        },
        {
          "temp_var": "nw_idx",
          "expression": "i_mr * n + j_mr",
          "description": "Northwest neighbor linear index"
        },
        {
          "temp_var": "n_idx",
          "expression": "i_mr * n + j",
          "description": "North neighbor linear index"
        },
        {
          "temp_var": "ne_idx",
          "expression": "i_m1 * n + j_p1",
          "description": "Northeast neighbor linear index (uses +/-1 as in original)"
        },
        {
          "temp_var": "w_idx",
          "expression": "center_idx - 1",
          "description": "West neighbor linear index"
        },
        {
          "temp_var": "e_idx",
          "expression": "center_idx + 1",
          "description": "East neighbor linear index"
        },
        {
          "temp_var": "sw_idx",
          "expression": "i_p1 * n + j_m1",
          "description": "Southwest neighbor linear index"
        },
        {
          "temp_var": "s_idx",
          "expression": "i_p1 * n + j",
          "description": "South neighbor linear index"
        },
        {
          "temp_var": "se_idx",
          "expression": "i_p1 * n + j_p1",
          "description": "Southeast neighbor linear index"
        },
        {
          "temp_var": "sum0",
          "expression": "A[nw_idx] + A[n_idx]",
          "description": "Accumulate in original left-to-right order: NW + N"
        },
        {
          "temp_var": "sum1",
          "expression": "sum0 + A[ne_idx]",
          "description": "Add NE"
        },
        {
          "temp_var": "sum2",
          "expression": "sum1 + A[w_idx]",
          "description": "Add W"
        },
        {
          "temp_var": "sum3",
          "expression": "sum2 + A[center_idx]",
          "description": "Add center"
        },
        {
          "temp_var": "sum4",
          "expression": "sum3 + A[e_idx]",
          "description": "Add E"
        },
        {
          "temp_var": "sum5",
          "expression": "sum4 + A[sw_idx]",
          "description": "Add SW"
        },
        {
          "temp_var": "sum6",
          "expression": "sum5 + A[s_idx]",
          "description": "Add S"
        },
        {
          "temp_var": "sum7",
          "expression": "sum6 + A[se_idx]",
          "description": "Add SE"
        },
        {
          "temp_var": "stencil_avg",
          "expression": "sum7 / STENCIL_NEIGHBOR_COUNT",
          "description": "Divide by neighbor count to compute the average"
        }
      ],
      "final_expression": "stencil_avg"
    }
  ]
}